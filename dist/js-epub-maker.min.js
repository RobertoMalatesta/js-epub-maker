!function e(n,t,i){function o(s,l){if(!t[s]){if(!n[s]){var c="function"==typeof require&&require;if(!l&&c)return c(s,!0);if(r)return r(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var u=t[s]={exports:{}};n[s][0].call(u.exports,function(e){var t=n[s][1][e];return o(t?t:e)},u,u.exports,e,n,t,i)}return t[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,n,t){!function(){"use strict";var i="undefined"!=typeof console&&console.debug?function(){console.debug.apply(console,arguments)}:function(){},o=e("./js/slugify.js"),r={"idpf-wasteland":e("../src/js/template-builders/idpf-wasteland-builder.js").builder},s=function(){var e=this,n={toc:[],landmarks:[],sections:[]};this.withUuid=function(t){return n.uuid=t,e},this.withTemplate=function(t){return n.templateName=t,e},this.withTitle=function(t){return n.title=t,n.slug=o(t),e},this.withLanguage=function(t){return n.lang=t,e},this.withAuthor=function(t){return n.author=t,e},this.withModificationDate=function(t){return n.modificationDate=t.toISOString(),e},this.withRights=function(t){return n.rights=t,e},this.withCover=function(t,i){return n.coverUrl=t,n.coverRights=i,e},this.withAttributionUrl=function(t){return n.attributionUrl=t,e},this.withSection=function(t){return n.sections.push(t),Array.prototype.push.apply(n.toc,t.collectToc()),Array.prototype.push.apply(n.landmarks,t.collectLandmarks()),e},this.makeEpub=function(){return n.publicationDate=(new Date).toISOString(),r[n.templateName].make(n).then(function(e){i("generating epub for: "+n.title);var t=e.generate({type:"blob",mimeType:"application/epub+zip",compression:"DEFLATE"});return t})},this.downloadEpub=function(){e.makeEpub().then(function(e){var t=n.slug+".epub";i('saving "'+t+'"...'),saveAs(e,t)})}};if(s.Section=function(e,n,t,i,o){var r=this;this.epubType=e,this.id=n,this.content=t,this.includeInToc=i,this.includeInLandmarks=o,this.subSections=[],this.withSubSection=function(e){return r.subSections.push(e),r},this.collectToc=function(){for(var e=r.includeInToc?[r]:[],n=0;n<r.subSections.length;n++)Array.prototype.push.apply(e,r.subSections[n].collectToc());return e},this.collectLandmarks=function(){for(var e=r.includeInLandmarks?[r]:[],n=0;n<r.subSections.length;n++)Array.prototype.push.apply(e,r.subSections[n].collectLandmarks());return e}},"undefined"!=typeof n)n.exports.EpubMaker=s;else if("undefined"!=typeof t)t.EpubMaker=s;else if("undefined"==typeof window)throw new Error("unable to expose EpubMaker: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.EpubMaker=s)}()},{"../src/js/template-builders/idpf-wasteland-builder.js":3,"./js/slugify.js":2}],2:[function(e,n,t){!function(){function e(e){return e.toLowerCase().replace(/\s/g,"-")}if(n.exports="undefined"!=typeof s&&s.slugify?s.slugify:e,n.exports===e){var t="undefined"!=typeof console&&console.debug?console.debug:function(){};t.call(console,"underscore.string not found, falling back on (very) simple slugify..")}}()},{}],3:[function(e,n,t){!function(){"use strict";var e={mimetype:"application/epub+zip",container:'<?xml version="1.0" encoding="UTF-8"?>\n<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0">\n	<rootfiles>\n		<rootfile full-path="EPUB/{{slug}}.opf" 	\n			media-type="application/oebps-package+xml"/>\n	</rootfiles>\n</container>',opf:'<?xml version="1.0" encoding="UTF-8"?>\n<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="uid" xml:lang="en-US" prefix="cc: http://creativecommons.org/ns#">\n    <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n        <dc:identifier id="uid">{{uuid}}</dc:identifier>\n        <dc:title>{{title}}</dc:title>\n        <dc:creator>{{author}}</dc:creator>\n        <dc:language>{{lang}}</dc:language>\n        <dc:date>{{publicationDate}}</dc:date>\n        <meta property="dcterms:modified">{{modificationDate}}</meta>\n        {{#if rights}}\n            <!-- rights expressions for the work as a whole -->\n            {{#if rights.description}}<dc:rights>{{rights.description}}</dc:rights>{{/if}}\n            {{#if rights.license}}<link rel="cc:license" href="{{rights.license}}"/>{{/if}}\n            {{#if rights.attributionUrl}}<meta property="cc:attributionURL">{{attributionUrl}}</meta>{{/if}}\n        {{/if}}\n        {{#if coverUrl}}{{#if coverRights}}\n            <!-- rights expression for the cover image -->       \n            {{#if coverRights.license}}<link rel="cc:license" refines="#cover" href="{{coverRights.license}}" />{{/if}}\n            {{#if coverRights.attributionUrl}}<link rel="cc:attributionURL" refines="#cover" href="{{coverRights.attributionUrl}}" />{{/if}}\n            <!-- cover meta element included for 2.0 reading system compatibility: -->\n            <meta name="cover" content="cover"/>\n        {{/if}}{{/if}}\n    </metadata>\n    <manifest>\n        <item id="t1" href="{{slug}}-content.xhtml" media-type="application/xhtml+xml" />\n        <item id="nav" href="{{slug}}-nav.xhtml" properties="nav" media-type="application/xhtml+xml" />\n        {{#if coverUrl}}\n        <item id="cover" href="{{slug}}-cover.jpg" media-type="image/jpeg" properties="cover-image" />\n        {{/if}}\n        <item id="css" href="{{slug}}.css" media-type="text/css" />\n        <item id="css-night" href="{{slug}}-night.css" media-type="text/css" />\n        <!-- ncx included for 2.0 reading system compatibility: -->\n        <item id="ncx" href="{{slug}}.ncx" media-type="application/x-dtbncx+xml" />\n    </manifest>\n    <spine toc="ncx">\n        <itemref idref="t1" />        \n    </spine>    \n</package>\n',ncx:'<?xml version="1.0" encoding="UTF-8"?>\n<ncx xmlns:ncx="http://www.daisy.org/z3986/2005/ncx/" xmlns="http://www.daisy.org/z3986/2005/ncx/"\n    version="2005-1" xml:lang="en">\n    <head>\n        <meta name="dtb:uid" content="{{uuid}}"/>\n    </head>\n    <docTitle>\n        <text>{{title}}</text>\n    </docTitle>\n    <navMap>\n        <!-- 2.01 NCX: playOrder is optional -->\n		{{#each toc}}\n        <navPoint id="{{id}}">\n            <navLabel>\n                <text>{{content.title}}</text>\n            </navLabel>\n            <content src="{{../slug}}-content.xhtml#{{id}}"/>\n        </navPoint>\n		{{/each}}\n    </navMap>\n</ncx>\n',nav:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n	xmlns:epub="http://www.idpf.org/2007/ops">\n	<head>\n		<meta charset="utf-8"></meta>		\n		<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n		<link rel="alternate stylesheet" type="text/css" href="{{slug}}-night.css" class="night" title="night"/>		\n	</head>\n	<body>\n		<nav epub:type="toc" id="toc">\n			<ol>\n				{{#each toc}}\n				<li><a href="{{../slug}}-content.xhtml#{{id}}">{{content.title}}</a></li>\n				{{/each}}\n			</ol>			\n		</nav>\n		<nav epub:type="landmarks">\n			<ol>\n				{{#each landmarks}}\n				<li><a epub:type="{{epubType}}" href="{{../slug}}-content.xhtml#{{id}}">{{content.title}}</a></li>\n				{{/each}}\n			</ol>\n		</nav>\n	</body>\n</html>\n',css:'@charset "UTF-8";\n@import "{{slug}}.css";\n\nbody {\n    color: rgb(255,250,205);\n    background-color: rgb(20,20,20);\n}\n\nspan.lnum {\n    color: rgb(175,170,125);\n}\n\na.noteref {\n    color: rgb(120,120,120);\n}\n\nsection#rearnotes a {\n    color: rgb(255,250,205);\n}',cssNight:'@charset "UTF-8";\n@import "{{slug}}.css";\n\nbody {\n    color: rgb(255,250,205);\n    background-color: rgb(20,20,20);\n}\n\nspan.lnum {\n    color: rgb(175,170,125);\n}\n\na.noteref {\n    color: rgb(120,120,120);\n}\n\nsection#rearnotes a {\n    color: rgb(255,250,205);\n}',content:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" xmlns:epub="http://www.idpf.org/2007/ops">\n	<head>\n		<meta charset="utf-8"></meta>\n		<title>{{title}}</title>\n		<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n		<link rel="alternate stylesheet" type="text/css" href="{{slug}}-night.css" class="night" title="night"/>\n		<!-- <link rel="stylesheet" type="text/css" href="{{slug}}-night.css" class="night" title="night"/> -->		\n	</head>\n	<body>\n		{{#each sections}}{{> sectionTemplate}}{{/each}}\n	</body>\n</html>\n',sectionsTemplate:'<!-- strange if-construction, but this is a workaround for gulp-js-html-inject, whose minifier wreaks havoc otherwise -->\n{{#if epubType}}<section epub:type="{{epubType}}" id="{{id}}">{{else}}<section id="{{id}}">{{/if}}\n\n    {{#if content.title}}<h2>{{content.title}}</h2>{{/if}} \n    {{#if content.content}}{{{content.content}}}{{/if}}\n    \n    {{#each subSections}} {{> sectionTemplate}} {{/each}}\n    \n{{#if epubType}}</section>{{else}}</section>{{/if}}'},i=function(){function n(n,t){n.file("mimetype",e.mimetype)}function t(n,t){n.folder("META-INF").file("container.xml",a(e.container,t))}function i(n,t){n.folder("EPUB").file(t.slug+".opf",a(e.opf,t))}function o(e,n){var t=$.Deferred();return n.coverUrl?JSZipUtils.getBinaryContent(n.coverUrl,function(i,o){i?t.reject(i):(e.folder("EPUB").file(n.slug+"-cover.jpg",o,{binary:!0}),t.resolve(""))}):t.resolve(""),t.promise()}function r(n,t){n.folder("EPUB").file(t.slug+".ncx",a(e.ncx,t))}function s(n,t){n.folder("EPUB").file(t.slug+"-nav.xhtml",a(e.nav,t))}function l(n,t){n.folder("EPUB").file(t.slug+".css",a(e.css,t,!0)),n.folder("EPUB").file(t.slug+"-night.css",a(e.cssNight,t,!0))}function c(n,t){Handlebars.registerPartial("sectionTemplate",e.sectionsTemplate),n.folder("EPUB").file(t.slug+"-content.xhtml",a(e.content,t))}function a(e,n,t){function i(e){return t||"undefined"==typeof html_beautify?e:html_beautify(e,{end_with_newline:!1,indent_char:"	",indent_inner_html:!0,indent_size:"1",preserve_newlines:!1,wrap_line_length:"0",unformatted:[],selector_separator_newline:!1,newline_between_rules:!0})}return i(Handlebars.compile(e)(n))}this.make=function(e){console.debug("building epub",e);var a=new JSZip,u=$.Deferred();return $.when(n(a,e),t(a,e),i(a,e),o(a,e),r(a,e),s(a,e),l(a,e),c(a,e)).then(function(){u.resolve(a)}),u.promise()}};if("undefined"!=typeof n)n.exports.builder=new i;else if("undefined"!=typeof t)t.builder=new i;else if("undefined"==typeof window)throw new Error("unable to expose module: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.epubMaker=new i)}()},{}]},{},[1]);