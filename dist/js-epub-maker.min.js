!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){!function(){"use strict";var r=e("./js/util/console")(),i=e("./js/util/slugify");e("./js/util/handlebar-helpers");var o={"idpf-wasteland":e("../src/js/template-builders/idpf-wasteland-builder.js").builder},s=function(){var e=this,t={toc:[],landmarks:[],sections:[],stylesheet:{}};this.withUuid=function(n){return t.uuid=n,e},this.withTemplate=function(n){return t.templateName=n,e},this.withTitle=function(n){return t.title=n,t.slug=i(n),e},this.withLanguage=function(n){return t.lang=n,e},this.withAuthor=function(n){return t.author=n,e},this.withModificationDate=function(n){return t.modificationDate=n.toISOString(),e},this.withRights=function(n){return t.rights=n,e},this.withCover=function(n,r){return t.coverUrl=n,t.coverRights=r,e},this.withAttributionUrl=function(n){return t.attributionUrl=n,e},this.withStylesheetUrl=function(n,r){return t.stylesheet={url:n,styles:"",replaceOriginal:r},e},this.withSection=function(n){return t.sections.push(n),Array.prototype.push.apply(t.toc,n.collectToc()),Array.prototype.push.apply(t.landmarks,n.collectLandmarks()),e},this.makeEpub=function(){return t.publicationDate=(new Date).toISOString(),o[t.templateName].make(t).then(function(e){r.info("generating epub for: "+t.title);var n=e.generate({type:"blob",mimeType:"application/epub+zip",compression:"DEFLATE"});return n})},this.downloadEpub=function(){e.makeEpub().then(function(e){var n=t.slug+".epub";r.debug('saving "'+n+'"...'),saveAs(e,n)})}};if(s.epubtypes=e("../src/js/epub-types.js"),s.Section=function(e,t,n,r,i){function o(e,t){for(var n=e[t]?[e]:[],r=0;r<e.subSections.length;r++)Array.prototype.push.apply(n,o(e.subSections[r],t));return n}var s=this;this.epubType=e,this.id=t,this.content=n,this.includeInToc=r,this.includeInLandmarks=i,this.subSections=[],this.withSubSection=function(e){return s.subSections.push(e),s},this.collectToc=function(){return o(this,"includeInToc")},this.collectLandmarks=function(){return o(this,"includeInLandmarks")}},"undefined"!=typeof t)t.exports.EpubMaker=s;else if("undefined"!=typeof n)n.EpubMaker=s;else if("undefined"==typeof window)throw new Error("unable to expose EpubMaker: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.EpubMaker=s)}()},{"../src/js/epub-types.js":4,"../src/js/template-builders/idpf-wasteland-builder.js":5,"./js/util/console":7,"./js/util/handlebar-helpers":8,"./js/util/slugify":9}],2:[function(e,t,n){function r(){l=!1,a.length?u=a.concat(u):f=-1,u.length&&i()}function i(){if(!l){var e=setTimeout(r);l=!0;for(var t=u.length;t;){for(a=u,u=[];++f<t;)a&&a[f].run();f=-1,t=u.length}a=null,l=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function s(){}var a,c=t.exports={},u=[],l=!1,f=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new o(e,t)),1!==u.length||l||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=s,c.addListener=s,c.once=s,c.off=s,c.removeListener=s,c.removeAllListeners=s,c.emit=s,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],3:[function(e,t,n){(function(e){!function(n){"use strict";function r(e){d(function(){throw e})}function i(e){return this.then(e,n)}function o(e){return this.then(n,e)}function s(e,t){return this.then(function(t){return h(e)?e.apply(null,m(t)?t:[t]):j.onlyFuncs?t:e},t||n)}function a(e){function t(){e()}return this.then(t,t),this}function c(e){return this.then(function(t){return h(e)?e.apply(null,m(t)?t.splice(0,0,void 0)&&t:[void 0,t]):j.onlyFuncs?t:e},function(t){return e(t)})}function u(e){return this.then(n,e?function(t){throw e(t),t}:r)}function l(e,t){var n=v(e);if(1===n.length&&m(n[0])){if(!n[0].length)return j.fulfilled([]);n=n[0]}var r=[],i=j(),o=n.length;if(o)for(var s=function(e){n[e]=j.promisify(n[e]),n[e].then(function(s){r[e]=t?n[e]:s,--o||i.resolve(r)},function(s){t?(r[e]=n[e],--o||i.resolve(r)):i.reject(s)})},a=0,c=o;c>a;a++)s(a);else i.resolve(r);return i.promise}function f(e,t){return e.then(h(t)?t:function(){return t})}function p(e){var t=v(e);1===t.length&&m(t[0])&&(t=t[0]);for(var n=j(),r=0,i=t.length,o=j.resolved();i>r;r++)o=f(o,t[r]);return n.resolve(o),n.promise}var d,h=function(e){return"function"==typeof e},m=function(e){return Array.isArray?Array.isArray(e):e instanceof Array},g=function(e){return!(!e||!(typeof e).match(/function|object/))},y=function(e){return e===!1||e===n||null===e},v=function(e,t){return[].slice.call(e,t)},w="undefined",b=typeof TypeError===w?Error:TypeError;if(typeof e!==w&&e.nextTick)d=e.nextTick;else if(typeof MessageChannel!==w){var x=new MessageChannel,k=[];x.port1.onmessage=function(){k.length&&k.shift()()},d=function(e){k.push(e),x.port2.postMessage(0)}}else d=function(e){setTimeout(e,0)};var j=function(e){function t(){if(0!==m){var e,t=v,n=0,r=t.length,i=~m?0:1;for(v=[];r>n;n++)(e=t[n][i])&&e(f)}}function r(e){function n(e){return function(t){return i?void 0:(i=!0,e(t))}}var i=!1;if(m)return this;try{var o=g(e)&&e.then;if(h(o)){if(e===w)throw new b("Promise can't resolve itself");return o.call(e,n(r),n(l)),this}}catch(s){return n(l)(s),this}return p(function(){f=e,m=1,t()}),this}function l(e){return m||p(function(){try{throw e}catch(n){f=n}m=-1,t()}),this}var f,p=(n!==e?e:j.alwaysAsync)?d:function(e){e()},m=0,v=[],w={then:function(e,n){var r=j();return v.push([function(t){try{y(e)?r.resolve(t):r.resolve(h(e)?e(t):j.onlyFuncs?t:e)}catch(n){r.reject(n)}},function(e){if((y(n)||!h(n)&&j.onlyFuncs)&&r.reject(e),n)try{r.resolve(h(n)?n(e):n)}catch(t){r.reject(t)}}]),0!==m&&p(t),r.promise},success:i,error:o,otherwise:o,apply:s,spread:s,ensure:a,nodify:c,rethrow:u,isPending:function(){return 0===m},getStatus:function(){return m}};return w.toSource=w.toString=w.valueOf=function(){return f===n?this:f},{promise:w,resolve:r,fulfill:r,reject:l}};if(j.deferred=j.defer=j,j.nextTick=d,j.alwaysAsync=!0,j.onlyFuncs=!0,j.resolved=j.fulfilled=function(e){return j(!0).resolve(e).promise},j.rejected=function(e){return j(!0).reject(e).promise},j.wait=function(e){var t=j();return setTimeout(t.resolve,e||0),t.promise},j.delay=function(e,t){var n=j();return setTimeout(function(){try{n.resolve(h(e)?e.apply(null):e)}catch(t){n.reject(t)}},t||0),n.promise},j.promisify=function(e){return e&&h(e.then)?e:j.resolved(e)},j.all=function(){return l(arguments,!1)},j.resolveAll=function(){return l(arguments,!0)},j.sequence=function(){return p(arguments)},j.nodeCapsule=function(e,t){return t||(t=e,e=void 0),function(){var n=j(),r=v(arguments);r.push(function(e,t){e?n.reject(e):n.resolve(arguments.length>2?v(arguments,1):t)});try{t.apply(e,r)}catch(i){n.reject(i)}return n.promise}},"function"==typeof define&&define.amd)define("D.js",[],function(){return j});else if(typeof t!==w&&t.exports)t.exports=j;else if(typeof window!==w){var T=window.D;j.noConflict=function(){return window.D=T,j},window.D=j}}()}).call(this,e("_process"))},{_process:2}],4:[function(e,t,n){!function(){"use strict";function e(e){return{"abstract":"frontmatter",foreword:"frontmatter",preface:"frontmatter",introduction:"frontmatter",preamble:"frontmatter",epigraph:"frontmatter","non-specific frontmatter":"frontmatter",part:"bodymatter",chapter:"bodymatter",prologue:"bodymatter",conclusion:"bodymatter",epilogue:"bodymatter",afterword:"backmatter","non-specific backmatter":"backmatter",rearnote:"backmatter"}[e]}for(var n=[{name:"abstract",group:"Front Matter",description:"A short summary of the principle ideas, concepts and conclusions of the work, or of a section or except within it."},{name:"foreword",group:"Front Matter",description:"An introductory section that precedes the work, typically not written by the work's author."},{name:"preface",group:"Front Matter",description:"An introductory section that precedes the work, typically written by the work's author."},{name:"introduction",group:"Front Matter",description:"A section in the beginning of the work, typically introducing the reader to the scope or nature of the work's content."},{name:"preamble",group:"Front Matter",description:"A section in the beginning of the work, typically containing introductory and/or explanatory prose regarding the scope or nature of the work's content"},{name:"epigraph",group:"Front Matter",description:"A quotation that is pertinent but not integral to the text."},{name:"non-specific frontmatter",group:"Front Matter",description:"Content placed in the frontmatter section, but which has no specific semantic meaning."},{name:"part",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"chapter",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"prologue",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"conclusion",group:"Body Matter",description:"An ending section that typically wraps up the work."},{name:"epilogue",group:"Body Matter",description:"A concluding section that is typically written from a later point in time than the main story, although still part of the narrative."},{name:"afterword",group:"Back Matter",description:"A closing statement from the author or a person of importance to the story, typically providing insight into how the story came to be written, its significance or related events that have transpired since its timeline."},{name:"non-specific backmatter",group:"Back Matter",description:"Content placed in the backmatter section, but which has no specific semantic meaning."},{name:"rearnote",group:"Back Matter",description:"A note appearing in the rear (backmatter) of the work, or at the end of a section."}],r={},i=0;i<n.length;i++){var o=n[i].group;(r[o]||(r[o]=[])).push(n[i])}t.exports={types:n,groups:r,getGroup:e}}()},{}],5:[function(e,t,n){!function(){"use strict";var r=e("d.js"),i=e("../../js/util/console")(),o=e("../../js/util/ajax"),s={mimetype:"application/epub+zip",container:'<?xml version="1.0" encoding="UTF-8"?>\n<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0">\n	<rootfiles>\n		<rootfile full-path="EPUB/{{slug}}.opf" 	\n			media-type="application/oebps-package+xml"/>\n	</rootfiles>\n</container>',opf:'<?xml version="1.0" encoding="UTF-8"?>\n<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="uid" xml:lang="en-US" prefix="cc: http://creativecommons.org/ns#">\n    <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n        <dc:identifier id="uid">{{uuid}}</dc:identifier>\n        <dc:title>{{title}}</dc:title>\n        <dc:creator>{{author}}</dc:creator>\n        <dc:language>{{lang}}</dc:language>\n        <dc:date>{{publicationDate}}</dc:date>\n        <meta property="dcterms:modified">{{modificationDate}}</meta>\n        {{#if rights}}\n            <!-- rights expressions for the work as a whole -->\n            {{#if rights.description}}<dc:rights>{{rights.description}}</dc:rights>{{/if}}\n            {{#if rights.license}}<link rel="cc:license" href="{{rights.license}}"/>{{/if}}\n            {{#if rights.attributionUrl}}<meta property="cc:attributionURL">{{attributionUrl}}</meta>{{/if}}\n        {{/if}}\n        {{#if coverUrl}}\n            {{#if coverRights}}\n                <!-- rights expression for the cover image -->       \n                {{#if coverRights.license}}<link rel="cc:license" refines="#cover" href="{{coverRights.license}}" />{{/if}}\n                {{#if coverRights.attributionUrl}}<link rel="cc:attributionURL" refines="#cover" href="{{coverRights.attributionUrl}}" />{{/if}}\n            {{/if}}\n                <!-- cover meta element included for 2.0 reading system compatibility: -->\n                <meta name="cover" content="cover"/>\n        {{/if}}\n    </metadata>\n    <manifest>\n        <item id="t1" href="{{slug}}-content.xhtml" media-type="application/xhtml+xml" />\n        <item id="nav" href="{{slug}}-nav.xhtml" properties="nav" media-type="application/xhtml+xml" />\n        {{#if coverUrl}}\n        <item id="cover" href="{{slug}}-cover.{{extension coverUrl}}" media-type="{{mimetype coverUrl}}" properties="cover-image" />\n        {{/if}}\n        <item id="css" href="{{slug}}.css" media-type="text/css" />\n        <!-- ncx included for 2.0 reading system compatibility: -->\n        <item id="ncx" href="{{slug}}.ncx" media-type="application/x-dtbncx+xml" />\n    </manifest>\n    <spine toc="ncx">\n        <itemref idref="t1" />        \n    </spine>    \n</package>\n',ncx:'<?xml version="1.0" encoding="UTF-8"?>\n<ncx xmlns:ncx="http://www.daisy.org/z3986/2005/ncx/" xmlns="http://www.daisy.org/z3986/2005/ncx/"\n    version="2005-1" xml:lang="en">\n    <head>\n        <meta name="dtb:uid" content="{{uuid}}"/>\n    </head>\n    <docTitle>\n        <text>{{title}}</text>\n    </docTitle>\n    <navMap>\n        <!-- 2.01 NCX: playOrder is optional -->\n		{{#each toc}}\n        <navPoint id="{{id}}">\n            <navLabel>\n                <text>{{content.title}}</text>\n            </navLabel>\n            <content src="{{../slug}}-content.xhtml#{{id}}"/>\n        </navPoint>\n		{{/each}}\n    </navMap>\n</ncx>\n',nav:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n	xmlns:epub="http://www.idpf.org/2007/ops">\n	<head>\n		<meta charset="utf-8"></meta>		\n		<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n	</head>\n	<body>\n		<nav epub:type="toc" id="toc">\n			<ol>\n				{{#each toc}}\n				<li><a href="{{../slug}}-content.xhtml#{{id}}">{{content.title}}</a></li>\n				{{/each}}\n			</ol>			\n		</nav>\n		<nav epub:type="landmarks">\n			<ol>\n				{{#each landmarks}}\n				<li><a epub:type="{{epubType}}" href="{{../slug}}-content.xhtml#{{id}}">{{#if content.title}}{{content.title}}{{else}}{{epubType}}{{/if}}</a></li>\n				{{/each}}\n			</ol>\n		</nav>\n	</body>\n</html>\n',css:'@charset "UTF-8";\n@namespace "http://www.w3.org/1999/xhtml";\n@namespace epub "http://www.idpf.org/2007/ops";\n\nbody {\n    margin-left: 6em;\n    margin-right: 2em;\n    color: black;\n    font-family: times, \'times new roman\', serif;\n    background-color: rgb(255,255,245);\n    line-height: 1.5em;\n}\n\nh2 {\n    margin-top: 5em;\n    margin-bottom: 2em;\n}\n\nh3 {\n    margin-top: 3em;\n}\n\n.linegroup {\n    margin-top: 1.6em;\n}\n\nspan.lnum {\n    float: right;\n    color: gray;\n    font-size : 90%;\n}\n\na.noteref {\n    color: rgb(215,215,195);\n    text-decoration: none;\n    margin-left: 0.5em;\n    margin-right: 0.5em;\n}\n\nsection#rearnotes a {\n    color: black;\n    text-decoration: none;\n    border-bottom : 1px dotted gray;\n    margin-right: 0.8em;\n}\n\n.indent {\n    padding-left: 3em;\n}\n\n.indent2 {\n    padding-left: 5em;\n}\n\n*[epub|type~=\'dedication\'] {\n    padding-left: 2em;\n}\n',content:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" xmlns:epub="http://www.idpf.org/2007/ops">\n	<head>\n		<meta charset="utf-8"></meta>\n		<title>{{title}}</title>\n		<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n	</head>\n	<body>\n		{{#each sections}}{{> sectionTemplate}}{{/each}}\n	</body>\n</html>\n',sectionsTemplate:'{{!-- strange if-construction, but this is a workaround for gulp-js-html-inject, whose minifier wreaks havoc otherwise --}}\n{{#if epubType}}<section epub:type="{{epubType}}" id="{{id}}">{{else}}<section id="{{id}}">{{/if}}\n\n    {{#if content.title}}<h2>{{content.title}}</h2>{{/if}} \n    {{#if content.content}}{{{content.content}}}{{/if}}\n    \n    {{#each subSections}} {{> sectionTemplate}} {{/each}}\n    \n{{#if epubType}}</section>{{else}}</section>{{/if}}'},a=function(){function e(e){e.file("mimetype",s.mimetype)}function t(e,t){e.folder("META-INF").file("container.xml",p(s.container,t))}function n(e,t){e.folder("EPUB").file(t.slug+".opf",p(s.opf,t))}function a(e,t){var n=r();return t.coverUrl?JSZipUtils.getBinaryContent(t.coverUrl,function(r,i){if(r)n.reject(r);else{var o=t.coverUrl.substr(t.coverUrl.lastIndexOf(".")+1);e.folder("EPUB").file(t.slug+"-cover."+o,i,{binary:!0}),n.resolve("")}}):n.resolve(!0),n.promise}function c(e,t){e.folder("EPUB").file(t.slug+".ncx",p(s.ncx,t))}function u(e,t){e.folder("EPUB").file(t.slug+"-nav.xhtml",p(s.nav,t))}function l(e,t){function n(){var n={original:t.stylesheet.replaceOriginal?"":s.css,custom:t.styles};e.folder("EPUB").file(t.slug+".css",p("{{{original}}}{{{custom}}}",n,!0)),i.resolve(!0)}var i=r();return t.stylesheet.url?o(t.stylesheet.url).then(function(e){t.styles=e.data,n()}):(n(),i.promise)}function f(e,t){Handlebars.registerPartial("sectionTemplate",s.sectionsTemplate),e.folder("EPUB").file(t.slug+"-content.xhtml",p(s.content,t))}function p(e,t,n){function r(e){return n||"undefined"==typeof html_beautify?e:html_beautify(e,{end_with_newline:!1,indent_char:"	",indent_inner_html:!0,indent_size:"1",preserve_newlines:!1,wrap_line_length:"0",unformatted:[],selector_separator_newline:!1,newline_between_rules:!0})}return r(Handlebars.compile(e)(t))}this.make=function(o){i.debug("building epub",o);var s=new JSZip,p=r();return r.all(e(s),t(s,o),n(s,o),a(s,o),c(s,o),u(s,o),l(s,o),f(s,o)).then(function(){p.resolve(s)}),p.promise}};if("undefined"!=typeof t)t.exports.builder=new a;else if("undefined"!=typeof n)n.builder=new a;else if("undefined"==typeof window)throw new Error("unable to expose module: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.epubMaker=new a)}()},{"../../js/util/ajax":6,"../../js/util/console":7,"d.js":3}],6:[function(e,t,n){!function(){"use strict";var n=e("d.js"),r=e("../../js/util/console")();t.exports=function(e,t){var i=n();try{var o=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");o.open(t?"POST":"GET",e,1),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){o.readyState>3&&i.resolve({data:o.responseText,xhr:o})},o.send(t)}catch(s){r.error(s),i.reject(s)}return i.promise}}()},{"../../js/util/console":7,"d.js":3}],7:[function(e,t,n){!function(){"use strict";function e(){}t.exports=function(){return"undefined"!=typeof console?console:{log:e,info:e,debug:e,warn:e,error:e}}}()},{}],8:[function(e,t,n){!function(){"use strict";function e(e){return e.substr(e.lastIndexOf(".")+1)}var t={jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp",png:"image/png",svg:"image/svg+xml",gif:"image/gif"};Handlebars.registerHelper("extension",function(t){return e(t)}),Handlebars.registerHelper("mimetype",function(n){return t[e(n)]})}()},{}],9:[function(e,t,n){!function(){"use strict";function e(e){return e.toLowerCase().replace(/\s\W/g,"-")}if(t.exports="undefined"!=typeof s&&s.slugify?s.slugify:e,t.exports===e){var n="undefined"!=typeof console&&console.debug?console.debug:function(){};n.call(console,"underscore.string not found, falling back on (very) simple slugify..")}}()},{}]},{},[1]);