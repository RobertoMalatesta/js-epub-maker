!function n(e,t,r){function i(s,c){if(!t[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[s]={exports:{}};e[s][0].call(l.exports,function(n){var t=e[s][1][n];return i(t?t:n)},l,l.exports,n,e,t,r)}return t[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(n,e,t){!function(){"use strict";var r=n("./js/util/console")(),i=n("./js/util/slugify");n("./js/util/handlebar-helpers");var o={"idpf-wasteland":n("../src/js/template-builders/idpf-wasteland-builder.js").builder},s=function(){var n=this,e={toc:[],landmarks:[],sections:[]};this.withUuid=function(t){return e.uuid=t,n},this.withTemplate=function(t){return e.templateName=t,n},this.withTitle=function(t){return e.title=t,e.slug=i(t),n},this.withLanguage=function(t){return e.lang=t,n},this.withAuthor=function(t){return e.author=t,n},this.withModificationDate=function(t){return e.modificationDate=t.toISOString(),n},this.withRights=function(t){return e.rights=t,n},this.withCover=function(t,r){return e.coverUrl=t,e.coverRights=r,n},this.withAttributionUrl=function(t){return e.attributionUrl=t,n},this.withSection=function(t){return e.sections.push(t),Array.prototype.push.apply(e.toc,t.collectToc()),Array.prototype.push.apply(e.landmarks,t.collectLandmarks()),n},this.makeEpub=function(){return e.publicationDate=(new Date).toISOString(),o[e.templateName].make(e).then(function(n){r.info("generating epub for: "+e.title);var t=n.generate({type:"blob",mimeType:"application/epub+zip",compression:"DEFLATE"});return t})},this.downloadEpub=function(){n.makeEpub().then(function(n){var t=e.slug+".epub";r.debug('saving "'+t+'"...'),saveAs(n,t)})}};if(s.epubtypes=n("../src/js/epub-types.js"),s.Section=function(n,e,t,r,i){function o(n,e){for(var t=n[e]?[n]:[],r=0;r<n.subSections.length;r++)Array.prototype.push.apply(t,o(n.subSections[r],e));return t}var s=this;this.epubType=n,this.id=e,this.content=t,this.includeInToc=r,this.includeInLandmarks=i,this.subSections=[],this.withSubSection=function(n){return s.subSections.push(n),s},this.collectToc=function(){return o(this,"includeInToc")},this.collectLandmarks=function(){return o(this,"includeInLandmarks")}},"undefined"!=typeof e)e.exports.EpubMaker=s;else if("undefined"!=typeof t)t.EpubMaker=s;else if("undefined"==typeof window)throw new Error("unable to expose EpubMaker: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.EpubMaker=s)}()},{"../src/js/epub-types.js":4,"../src/js/template-builders/idpf-wasteland-builder.js":5,"./js/util/console":6,"./js/util/handlebar-helpers":7,"./js/util/slugify":8}],2:[function(n,e,t){function r(){l=!1,c.length?u=c.concat(u):f=-1,u.length&&i()}function i(){if(!l){var n=setTimeout(r);l=!0;for(var e=u.length;e;){for(c=u,u=[];++f<e;)c&&c[f].run();f=-1,e=u.length}c=null,l=!1,clearTimeout(n)}}function o(n,e){this.fun=n,this.array=e}function s(){}var c,a=e.exports={},u=[],l=!1,f=-1;a.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];u.push(new o(n,e)),1!==u.length||l||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(n){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(n){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],3:[function(n,e,t){(function(n){!function(t){"use strict";function r(n){h(function(){throw n})}function i(n){return this.then(n,t)}function o(n){return this.then(t,n)}function s(n,e){return this.then(function(e){return d(n)?n.apply(null,m(e)?e:[e]):T.onlyFuncs?e:n},e||t)}function c(n){function e(){n()}return this.then(e,e),this}function a(n){return this.then(function(e){return d(n)?n.apply(null,m(e)?e.splice(0,0,void 0)&&e:[void 0,e]):T.onlyFuncs?e:n},function(e){return n(e)})}function u(n){return this.then(t,n?function(e){throw n(e),e}:r)}function l(n,e){var t=b(n);if(1===t.length&&m(t[0])){if(!t[0].length)return T.fulfilled([]);t=t[0]}var r=[],i=T(),o=t.length;if(o)for(var s=function(n){t[n]=T.promisify(t[n]),t[n].then(function(s){r[n]=e?t[n]:s,--o||i.resolve(r)},function(s){e?(r[n]=t[n],--o||i.resolve(r)):i.reject(s)})},c=0,a=o;a>c;c++)s(c);else i.resolve(r);return i.promise}function f(n,e){return n.then(d(e)?e:function(){return e})}function p(n){var e=b(n);1===e.length&&m(e[0])&&(e=e[0]);for(var t=T(),r=0,i=e.length,o=T.resolved();i>r;r++)o=f(o,e[r]);return t.resolve(o),t.promise}var h,d=function(n){return"function"==typeof n},m=function(n){return Array.isArray?Array.isArray(n):n instanceof Array},g=function(n){return!(!n||!(typeof n).match(/function|object/))},y=function(n){return n===!1||n===t||null===n},b=function(n,e){return[].slice.call(n,e)},w="undefined",v=typeof TypeError===w?Error:TypeError;if(typeof n!==w&&n.nextTick)h=n.nextTick;else if(typeof MessageChannel!==w){var x=new MessageChannel,k=[];x.port1.onmessage=function(){k.length&&k.shift()()},h=function(n){k.push(n),x.port2.postMessage(0)}}else h=function(n){setTimeout(n,0)};var T=function(n){function e(){if(0!==m){var n,e=b,t=0,r=e.length,i=~m?0:1;for(b=[];r>t;t++)(n=e[t][i])&&n(f)}}function r(n){function t(n){return function(e){return i?void 0:(i=!0,n(e))}}var i=!1;if(m)return this;try{var o=g(n)&&n.then;if(d(o)){if(n===w)throw new v("Promise can't resolve itself");return o.call(n,t(r),t(l)),this}}catch(s){return t(l)(s),this}return p(function(){f=n,m=1,e()}),this}function l(n){return m||p(function(){try{throw n}catch(t){f=t}m=-1,e()}),this}var f,p=(t!==n?n:T.alwaysAsync)?h:function(n){n()},m=0,b=[],w={then:function(n,t){var r=T();return b.push([function(e){try{y(n)?r.resolve(e):r.resolve(d(n)?n(e):T.onlyFuncs?e:n)}catch(t){r.reject(t)}},function(n){if((y(t)||!d(t)&&T.onlyFuncs)&&r.reject(n),t)try{r.resolve(d(t)?t(n):t)}catch(e){r.reject(e)}}]),0!==m&&p(e),r.promise},success:i,error:o,otherwise:o,apply:s,spread:s,ensure:c,nodify:a,rethrow:u,isPending:function(){return 0===m},getStatus:function(){return m}};return w.toSource=w.toString=w.valueOf=function(){return f===t?this:f},{promise:w,resolve:r,fulfill:r,reject:l}};if(T.deferred=T.defer=T,T.nextTick=h,T.alwaysAsync=!0,T.onlyFuncs=!0,T.resolved=T.fulfilled=function(n){return T(!0).resolve(n).promise},T.rejected=function(n){return T(!0).reject(n).promise},T.wait=function(n){var e=T();return setTimeout(e.resolve,n||0),e.promise},T.delay=function(n,e){var t=T();return setTimeout(function(){try{t.resolve(d(n)?n.apply(null):n)}catch(e){t.reject(e)}},e||0),t.promise},T.promisify=function(n){return n&&d(n.then)?n:T.resolved(n)},T.all=function(){return l(arguments,!1)},T.resolveAll=function(){return l(arguments,!0)},T.sequence=function(){return p(arguments)},T.nodeCapsule=function(n,e){return e||(e=n,n=void 0),function(){var t=T(),r=b(arguments);r.push(function(n,e){n?t.reject(n):t.resolve(arguments.length>2?b(arguments,1):e)});try{e.apply(n,r)}catch(i){t.reject(i)}return t.promise}},"function"==typeof define&&define.amd)define("D.js",[],function(){return T});else if(typeof e!==w&&e.exports)e.exports=T;else if(typeof window!==w){var j=window.D;T.noConflict=function(){return window.D=j,T},window.D=T}}()}).call(this,n("_process"))},{_process:2}],4:[function(n,e,t){!function(){"use strict";function n(n){return{"abstract":"frontmatter",foreword:"frontmatter",preface:"frontmatter",introduction:"frontmatter",preamble:"frontmatter",epigraph:"frontmatter","non-specific frontmatter":"frontmatter",part:"bodymatter",chapter:"bodymatter",prologue:"bodymatter",conclusion:"bodymatter",epilogue:"bodymatter",afterword:"backmatter","non-specific backmatter":"backmatter",rearnote:"backmatter"}[n]}for(var t=[{name:"abstract",group:"Front Matter",description:"A short summary of the principle ideas, concepts and conclusions of the work, or of a section or except within it."},{name:"foreword",group:"Front Matter",description:"An introductory section that precedes the work, typically not written by the work's author."},{name:"preface",group:"Front Matter",description:"An introductory section that precedes the work, typically written by the work's author."},{name:"introduction",group:"Front Matter",description:"A section in the beginning of the work, typically introducing the reader to the scope or nature of the work's content."},{name:"preamble",group:"Front Matter",description:"A section in the beginning of the work, typically containing introductory and/or explanatory prose regarding the scope or nature of the work's content"},{name:"epigraph",group:"Front Matter",description:"A quotation that is pertinent but not integral to the text."},{name:"non-specific frontmatter",group:"Front Matter",description:"Content placed in the frontmatter section, but which has no specific semantic meaning."},{name:"part",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"chapter",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"prologue",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"conclusion",group:"Body Matter",description:"An ending section that typically wraps up the work."},{name:"epilogue",group:"Body Matter",description:"A concluding section that is typically written from a later point in time than the main story, although still part of the narrative."},{name:"afterword",group:"Back Matter",description:"A closing statement from the author or a person of importance to the story, typically providing insight into how the story came to be written, its significance or related events that have transpired since its timeline."},{name:"non-specific backmatter",group:"Back Matter",description:"Content placed in the backmatter section, but which has no specific semantic meaning."},{name:"rearnote",group:"Back Matter",description:"A note appearing in the rear (backmatter) of the work, or at the end of a section."}],r={},i=0;i<t.length;i++){var o=t[i].group;(r[o]||(r[o]=[])).push(t[i])}e.exports={types:t,groups:r,getGroup:n}}()},{}],5:[function(n,e,t){!function(){"use strict";var r=n("d.js"),i=n("../../js/util/console")(),o={mimetype:"application/epub+zip",container:'<?xml version="1.0" encoding="UTF-8"?>\n<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0">\n	<rootfiles>\n		<rootfile full-path="EPUB/{{slug}}.opf" 	\n			media-type="application/oebps-package+xml"/>\n	</rootfiles>\n</container>',opf:'<?xml version="1.0" encoding="UTF-8"?>\n<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="uid" xml:lang="en-US" prefix="cc: http://creativecommons.org/ns#">\n    <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n        <dc:identifier id="uid">{{uuid}}</dc:identifier>\n        <dc:title>{{title}}</dc:title>\n        <dc:creator>{{author}}</dc:creator>\n        <dc:language>{{lang}}</dc:language>\n        <dc:date>{{publicationDate}}</dc:date>\n        <meta property="dcterms:modified">{{modificationDate}}</meta>\n        {{#if rights}}\n            <!-- rights expressions for the work as a whole -->\n            {{#if rights.description}}<dc:rights>{{rights.description}}</dc:rights>{{/if}}\n            {{#if rights.license}}<link rel="cc:license" href="{{rights.license}}"/>{{/if}}\n            {{#if rights.attributionUrl}}<meta property="cc:attributionURL">{{attributionUrl}}</meta>{{/if}}\n        {{/if}}\n        {{#if coverUrl}}\n            {{#if coverRights}}\n                <!-- rights expression for the cover image -->       \n                {{#if coverRights.license}}<link rel="cc:license" refines="#cover" href="{{coverRights.license}}" />{{/if}}\n                {{#if coverRights.attributionUrl}}<link rel="cc:attributionURL" refines="#cover" href="{{coverRights.attributionUrl}}" />{{/if}}\n            {{/if}}\n                <!-- cover meta element included for 2.0 reading system compatibility: -->\n                <meta name="cover" content="cover"/>\n        {{/if}}\n    </metadata>\n    <manifest>\n        <item id="t1" href="{{slug}}-content.xhtml" media-type="application/xhtml+xml" />\n        <item id="nav" href="{{slug}}-nav.xhtml" properties="nav" media-type="application/xhtml+xml" />\n        {{#if coverUrl}}\n        <item id="cover" href="{{slug}}-cover.{{extension coverUrl}}" media-type="{{mimetype coverUrl}}" properties="cover-image" />\n        {{/if}}\n        <item id="css" href="{{slug}}.css" media-type="text/css" />\n        <item id="css-night" href="{{slug}}-night.css" media-type="text/css" />\n        <!-- ncx included for 2.0 reading system compatibility: -->\n        <item id="ncx" href="{{slug}}.ncx" media-type="application/x-dtbncx+xml" />\n    </manifest>\n    <spine toc="ncx">\n        <itemref idref="t1" />        \n    </spine>    \n</package>\n',ncx:'<?xml version="1.0" encoding="UTF-8"?>\n<ncx xmlns:ncx="http://www.daisy.org/z3986/2005/ncx/" xmlns="http://www.daisy.org/z3986/2005/ncx/"\n    version="2005-1" xml:lang="en">\n    <head>\n        <meta name="dtb:uid" content="{{uuid}}"/>\n    </head>\n    <docTitle>\n        <text>{{title}}</text>\n    </docTitle>\n    <navMap>\n        <!-- 2.01 NCX: playOrder is optional -->\n		{{#each toc}}\n        <navPoint id="{{id}}">\n            <navLabel>\n                <text>{{content.title}}</text>\n            </navLabel>\n            <content src="{{../slug}}-content.xhtml#{{id}}"/>\n        </navPoint>\n		{{/each}}\n    </navMap>\n</ncx>\n',nav:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n	xmlns:epub="http://www.idpf.org/2007/ops">\n	<head>\n		<meta charset="utf-8"></meta>		\n		<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n		<link rel="alternate stylesheet" type="text/css" href="{{slug}}-night.css" class="night" title="night"/>		\n	</head>\n	<body>\n		<nav epub:type="toc" id="toc">\n			<ol>\n				{{#each toc}}\n				<li><a href="{{../slug}}-content.xhtml#{{id}}">{{content.title}}</a></li>\n				{{/each}}\n			</ol>			\n		</nav>\n		<nav epub:type="landmarks">\n			<ol>\n				{{#each landmarks}}\n				<li><a epub:type="{{epubType}}" href="{{../slug}}-content.xhtml#{{id}}">{{#if content.title}}{{content.title}}{{else}}{{epubType}}{{/if}}</a></li>\n				{{/each}}\n			</ol>\n		</nav>\n	</body>\n</html>\n',css:'@charset "UTF-8";\n@namespace "http://www.w3.org/1999/xhtml";\n@namespace epub "http://www.idpf.org/2007/ops";\n\nbody {\n    margin-left: 6em;\n    margin-right: 2em;\n    color: black;    \n    font-family: times, \'times new roman\', serif;    \n    background-color: rgb(255,255,245);\n    line-height: 1.5em;\n}\n\nh2 {\n    margin-top: 5em;\n    margin-bottom: 2em;\n}\n\nh3 {\n    margin-top: 3em;\n}\n\n.linegroup { \n    margin-top: 1.6em; \n}\n\nspan.lnum {\n    float: right;\n    color: gray;\n    font-size : 90%;\n}\n\na.noteref {    \n    color: rgb(215,215,195);\n    text-decoration: none;\n    margin-left: 0.5em;\n    margin-right: 0.5em;\n}\n\nsection#rearnotes a {\n    color: black;\n    text-decoration: none;\n    border-bottom : 1px dotted gray;\n    margin-right: 0.8em;\n}\n\n.indent {\n    padding-left: 3em;\n}\n\n.indent2 {\n    padding-left: 5em;\n}\n\n*[epub|type~=\'dedication\'] {\n    padding-left: 2em;\n}\n',cssNight:'@charset "UTF-8";\n@import "{{slug}}.css";\n\nbody {\n    color: rgb(255,250,205);\n    background-color: rgb(20,20,20);\n}\n\nspan.lnum {\n    color: rgb(175,170,125);\n}\n\na.noteref {\n    color: rgb(120,120,120);\n}\n\nsection#rearnotes a {\n    color: rgb(255,250,205);\n}',content:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" xmlns:epub="http://www.idpf.org/2007/ops">\n	<head>\n		<meta charset="utf-8"></meta>\n		<title>{{title}}</title>\n		<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n		<link rel="alternate stylesheet" type="text/css" href="{{slug}}-night.css" class="night" title="night"/>\n		<!-- <link rel="stylesheet" type="text/css" href="{{slug}}-night.css" class="night" title="night"/> -->		\n	</head>\n	<body>\n		{{#each sections}}{{> sectionTemplate}}{{/each}}\n	</body>\n</html>\n',sectionsTemplate:'{{!-- strange if-construction, but this is a workaround for gulp-js-html-inject, whose minifier wreaks havoc otherwise --}}\n{{#if epubType}}<section epub:type="{{epubType}}" id="{{id}}">{{else}}<section id="{{id}}">{{/if}}\n\n    {{#if content.title}}<h2>{{content.title}}</h2>{{/if}} \n    {{#if content.content}}{{{content.content}}}{{/if}}\n    \n    {{#each subSections}} {{> sectionTemplate}} {{/each}}\n    \n{{#if epubType}}</section>{{else}}</section>{{/if}}'},s=function(){function n(n){n.file("mimetype",o.mimetype)}function e(n,e){n.folder("META-INF").file("container.xml",f(o.container,e))}function t(n,e){n.folder("EPUB").file(e.slug+".opf",f(o.opf,e))}function s(n,e){var t=r();return e.coverUrl?JSZipUtils.getBinaryContent(e.coverUrl,function(r,i){if(r)t.reject(r);else{var o=e.coverUrl.substr(e.coverUrl.lastIndexOf(".")+1);n.folder("EPUB").file(e.slug+"-cover."+o,i,{binary:!0}),t.resolve("")}}):t.resolve(""),t.promise}function c(n,e){n.folder("EPUB").file(e.slug+".ncx",f(o.ncx,e))}function a(n,e){n.folder("EPUB").file(e.slug+"-nav.xhtml",f(o.nav,e))}function u(n,e){n.folder("EPUB").file(e.slug+".css",f(o.css,e,!0)),n.folder("EPUB").file(e.slug+"-night.css",f(o.cssNight,e,!0))}function l(n,e){Handlebars.registerPartial("sectionTemplate",o.sectionsTemplate),n.folder("EPUB").file(e.slug+"-content.xhtml",f(o.content,e))}function f(n,e,t){function r(n){return t||"undefined"==typeof html_beautify?n:html_beautify(n,{end_with_newline:!1,indent_char:"	",indent_inner_html:!0,indent_size:"1",preserve_newlines:!1,wrap_line_length:"0",unformatted:[],selector_separator_newline:!1,newline_between_rules:!0})}return r(Handlebars.compile(n)(e))}this.make=function(o){i.debug("building epub",o);var f=new JSZip,p=r();return r.all(n(f),e(f,o),t(f,o),s(f,o),c(f,o),a(f,o),u(f,o),l(f,o)).then(function(){p.resolve(f)}),p.promise}};if("undefined"!=typeof e)e.exports.builder=new s;else if("undefined"!=typeof t)t.builder=new s;else if("undefined"==typeof window)throw new Error("unable to expose module: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.epubMaker=new s)}()},{"../../js/util/console":6,"d.js":3}],6:[function(n,e,t){!function(){"use strict";function n(){}e.exports=function(){return"undefined"!=typeof console?console:{log:n,info:n,debug:n,warn:n,error:n}}}()},{}],7:[function(n,e,t){!function(){"use strict";function n(n){return n.substr(n.lastIndexOf(".")+1)}var e={jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp",png:"image/png",svg:"image/svg+xml",gif:"image/gif"};Handlebars.registerHelper("extension",function(e){return n(e)}),Handlebars.registerHelper("mimetype",function(t){return e[n(t)]})}()},{}],8:[function(n,e,t){!function(){"use strict";function n(n){return n.toLowerCase().replace(/\s\W/g,"-")}if(e.exports="undefined"!=typeof s&&s.slugify?s.slugify:n,e.exports===n){var t="undefined"!=typeof console&&console.debug?console.debug:function(){};t.call(console,"underscore.string not found, falling back on (very) simple slugify..")}}()},{}]},{},[1]);